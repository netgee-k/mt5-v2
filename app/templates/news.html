{% extends "base.html" %}

{% block title %}Market News - Trading Journal{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <h1 class="text-2xl font-bold mb-6 flex items-center gap-2 text-gray-900 dark:text-gray-100">
        <i class="fas fa-newspaper"></i> Market News
    </h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content - 2/3 width -->
        <div class="lg:col-span-2">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Latest Trading News</h2>
                    <form method="POST" action="/news/fetch" class="inline">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition text-sm font-medium flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i> Refresh News
                        </button>
                    </form>
                </div>
                <div class="p-6">
                    {% if news_alerts %}
                    <div class="space-y-4">
                        {% for news in news_alerts %}
                        <div class="news-item border border-gray-200 dark:border-gray-700 rounded-lg p-4 {% if news.is_read %}opacity-50{% endif %}">
                            <div class="flex justify-between items-start">
                                <div class="flex-1 mr-4">
                                    <div class="flex items-center mb-2">
                                        {% if news.symbol %}
                                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded mr-2">
                                            {{ news.symbol }}
                                        </span>
                                        {% endif %}
                                        {% if news.impact %}
                                        <span class="text-xs px-2 py-1 rounded mr-2 
                                            {% if news.impact == 'high' %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200
                                            {% elif news.impact == 'medium' %}bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200
                                            {% else %}bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300{% endif %}">
                                            {{ news.impact|title }}
                                        </span>
                                        {% endif %}
                                        <small class="text-gray-500 dark:text-gray-400">{{ news.source }}</small>
                                    </div>
                                    <h3 class="font-medium mb-2 text-gray-900 dark:text-gray-100">{{ news.title }}</h3>
                                    {% if news.summary %}
                                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-2">{{ news.summary }}</p>
                                    {% endif %}
                                    <small class="text-gray-500 dark:text-gray-400 flex items-center">
                                        <i class="far fa-clock mr-1"></i>
                                        {{ news.published_at.strftime('%Y-%m-%d %H:%M') }}
                                    </small>
                                </div>
                                {% if not news.is_read %}
                                <button class="border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 px-3 py-1 rounded-lg transition text-sm mark-news-read"
                                        data-news-id="{{ news.id }}">
                                    <i class="fas fa-check"></i>
                                </button>
                                {% endif %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8">
                        <i class="fas fa-newspaper text-4xl text-gray-300 dark:text-gray-700 mb-3"></i>
                        <h4 class="font-medium text-gray-700 dark:text-gray-300 mb-2">No News Yet</h4>
                        <p class="text-gray-500 dark:text-gray-400 text-sm mb-4">Fetch the latest market news to stay informed.</p>
                        <form method="POST" action="/news/fetch">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition font-medium flex items-center gap-2 mx-auto">
                                <i class="fas fa-sync-alt"></i> Fetch News
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Sidebar - 1/3 width -->
        <div class="space-y-6">
            <!-- News Preferences -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
                        <i class="fas fa-cog"></i> News Preferences
                    </h2>
                </div>
                <div class="p-6">
                    <form method="POST" action="/settings/preferences">
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 dark:text-gray-400 mb-2">Your Top Symbols</label>
                            <div class="p-4 bg-gray-50 dark:bg-gray-900 rounded-lg">
                                {% if top_symbols and top_symbols|length > 0 %}
                                <div class="flex flex-wrap gap-2">
                                    {% for stat in top_symbols[:3] %}
                                    <span class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-300 text-xs px-2 py-1 rounded">
                                        {{ stat.symbol }}
                                    </span>
                                    {% endfor %}
                                </div>
                                <small class="text-gray-500 dark:text-gray-400 text-xs mt-2 block">
                                    News will be prioritized for these symbols
                                </small>
                                {% else %}
                                <p class="text-gray-500 dark:text-gray-400 text-sm">Start trading to see your top symbols here</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 dark:text-gray-400 mb-2">News Impact Level</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input class="mr-2 text-blue-600" type="radio" name="news_impact" id="impact-high" value="high">
                                    <label class="text-sm text-gray-700 dark:text-gray-300" for="impact-high">
                                        High Impact Only
                                    </label>
                                </div>
                                <div class="flex items-center">
                                    <input class="mr-2 text-blue-600" type="radio" name="news_impact" id="impact-all" value="all" checked>
                                    <label class="text-sm text-gray-700 dark:text-gray-300" for="impact-all">
                                        All News
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full border border-blue-600 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-4 py-2 rounded-lg transition text-sm font-medium">
                            Update Preferences
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- News Categories -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
                        <i class="fas fa-chart-bar"></i> News Categories
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-2">
                        <a href="#" class="flex justify-between items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-750 p-2 rounded transition text-sm">
                            Forex News
                            <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">
                                {% if top_symbols %}
                                    {% set found = false %}
                                    {% for stat in top_symbols %}
                                        {% if stat.symbol and ('EURUSD' in stat.symbol or 'USDJPY' in stat.symbol or 'GBPUSD' in stat.symbol or 'AUDUSD' in stat.symbol or 'USDCAD' in stat.symbol) %}
                                            {% set found = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if found %}Recommended{% endif %}
                                {% endif %}
                            </span>
                        </a>
                        <a href="#" class="flex justify-between items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-750 p-2 rounded transition text-sm">
                            Stock Market
                            <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">
                                {% if top_symbols %}
                                    {% set found = false %}
                                    {% for stat in top_symbols %}
                                        {% if stat.symbol and ('.' not in stat.symbol and stat.symbol|length <= 5) %}
                                            {% set found = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if found %}Recommended{% endif %}
                                {% endif %}
                            </span>
                        </a>
                        <a href="#" class="flex justify-between items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-750 p-2 rounded transition text-sm">
                            Cryptocurrency
                            <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">
                                {% if top_symbols %}
                                    {% set found = false %}
                                    {% for stat in top_symbols %}
                                        {% if stat.symbol and ('BTC' in stat.symbol or 'ETH' in stat.symbol or 'XRP' in stat.symbol or 'LTC' in stat.symbol) %}
                                            {% set found = true %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if found %}Recommended{% endif %}
                                {% endif %}
                            </span>
                        </a>
                        <a href="#" class="flex justify-between items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-750 p-2 rounded transition text-sm">
                            Economic Indicators
                            <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">Always Relevant</span>
                        </a>
                        <a href="#" class="flex justify-between items-center text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-50 dark:hover:bg-gray-750 p-2 rounded transition text-sm">
                            Central Banks
                            <span class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">High Impact</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2">
                        <i class="fas fa-rocket"></i> Quick Actions
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 gap-3">
                        <a href="/checklist" class="border border-blue-600 text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-4 py-3 rounded-lg transition font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-tasks"></i> Pre-Trade Checklist
                        </a>
                        <a href="/risk-reward" class="border border-green-600 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 px-4 py-3 rounded-lg transition font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-balance-scale"></i> Risk Calculator
                        </a>
                        <a href="/weekly-report" class="border border-blue-400 text-blue-400 dark:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-4 py-3 rounded-lg transition font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-chart-line"></i> Weekly Report
                        </a>
                        <a href="/trades" class="border border-yellow-600 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-50 dark:hover:bg-yellow-900/30 px-4 py-3 rounded-lg transition font-medium flex items-center justify-center gap-2">
                            <i class="fas fa-exchange-alt"></i> Recent Trades
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
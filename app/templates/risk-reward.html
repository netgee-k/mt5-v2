{% extends "base.html" %}

{% block title %}Risk-Reward Analysis - MT5 Trading Journal{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
        <div>
            <h1 class="text-3xl font-bold mb-2 text-gray-900 dark:text-white">Risk-Reward Analysis</h1>
            <p class="text-gray-600 dark:text-gray-300">Analyze your trade risk management and reward potential</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <a href="/checklist" 
               class="bg-purple-600 dark:bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-700 dark:hover:bg-purple-600 transition-colors">
                <i class="fas fa-tasks mr-2"></i>Risk Checklist
            </a>
            <a href="/trades" 
               class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-4 py-2 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                <i class="fas fa-exchange-alt mr-2"></i>View Trades
            </a>
        </div>
    </div>
</div>

<!-- Risk-Reward Stats -->
{% if risk_reward_data %}
<div class="mb-8 grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow dark:shadow-gray-700/30 border border-gray-200 dark:border-gray-700">
        <div class="text-gray-500 dark:text-gray-400 text-sm">Average R:R</div>
        <div class="text-2xl font-bold {% if avg_rrr >= 1.5 %}text-green-600 dark:text-green-400{% elif avg_rrr >= 1 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
            {{ "%.2f"|format(avg_rrr) }}
        </div>
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Target: 1.5+
        </div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow dark:shadow-gray-700/30 border border-gray-200 dark:border-gray-700">
        <div class="text-gray-500 dark:text-gray-400 text-sm">Winning Trades R:R</div>
        <div class="text-2xl font-bold text-green-600 dark:text-green-400">{{ "%.2f"|format(avg_winning_rrr) }}</div>
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Higher is better
        </div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow dark:shadow-gray-700/30 border border-gray-200 dark:border-gray-700">
        <div class="text-gray-500 dark:text-gray-400 text-sm">Losing Trades R:R</div>
        <div class="text-2xl font-bold text-red-600 dark:text-red-400">{{ "%.2f"|format(avg_losing_rrr) }}</div>
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            Lower is better
        </div>
    </div>
    <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow dark:shadow-gray-700/30 border border-gray-200 dark:border-gray-700">
        <div class="text-gray-500 dark:text-gray-400 text-sm">Trades Analyzed</div>
        <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ total_trades }}</div>
        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            With SL/TP data
        </div>
    </div>
</div>

<!-- Success Rate by R:R Range -->
<div class="mb-8 bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 overflow-hidden border border-gray-200 dark:border-gray-700">
    <div class="px-6 py-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
        <h2 class="text-lg font-bold text-gray-900 dark:text-white">Success Rate by Risk-Reward Ratio</h2>
        <p class="text-sm text-gray-600 dark:text-gray-300">How your win rate changes with different risk-reward ratios</p>
    </div>
    <div class="p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead>
                    <tr class="bg-gray-50 dark:bg-gray-900">
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">R:R Range</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Total Trades</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Winning Trades</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Win Rate</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Assessment</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                    {% for range, data in success_by_rrr.items() %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50">
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ range }}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ data.total }}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ data.wins }}</td>
                        <td class="px-4 py-3 text-sm">
                            {% set win_rate = (data.wins / data.total * 100) if data.total > 0 else 0 %}
                            <span class="font-medium {% if win_rate > 50 %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {{ "%.1f"|format(win_rate) }}%
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            {% if range == '1:2+' and win_rate > 40 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                Excellent
                            </span>
                            {% elif range == '1:1.5-1:2' and win_rate > 35 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                Good
                            </span>
                            {% elif range == '1:1-1:1.5' and win_rate > 30 %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200">
                                Fair
                            </span>
                            {% else %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">
                                Needs Improvement
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Recent Trades Analysis -->
<div class="mb-8 bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 overflow-hidden border border-gray-200 dark:border-gray-700">
    <div class="px-6 py-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
        <h2 class="text-lg font-bold text-gray-900 dark:text-white">Recent Trades Analysis</h2>
        <p class="text-sm text-gray-600 dark:text-gray-300">Detailed breakdown of your recent trades with risk-reward data</p>
    </div>
    <div class="p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead>
                    <tr class="bg-gray-50 dark:bg-gray-900">
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Ticket</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Symbol</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Type</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Profit</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Risk</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Reward</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">R:R</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Result</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                    {% for trade in risk_reward_data %}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-900/50">
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white font-mono">{{ trade.ticket }}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white font-medium">{{ trade.symbol }}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full {% if trade.type == 'BUY' %}bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200{% else %}bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200{% endif %}">
                                {{ trade.type }}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm font-medium {% if trade.profit > 0 %}text-green-600 dark:text-green-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                            ${{ "%.2f"|format(trade.profit) }}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ "%.5f"|format(trade.risk) }}</td>
                        <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ "%.5f"|format(trade.reward) }}</td>
                        <td class="px-4 py-3 text-sm font-medium">
                            <span class="{% if trade.rrr >= 1.5 %}text-green-600 dark:text-green-400{% elif trade.rrr >= 1 %}text-yellow-600 dark:text-yellow-400{% else %}text-red-600 dark:text-red-400{% endif %}">
                                {{ "%.2f"|format(trade.rrr) }}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm">
                            {% if trade.win %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                                <i class="fas fa-check mr-1"></i> Win
                            </span>
                            {% else %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">
                                <i class="fas fa-times mr-1"></i> Loss
                            </span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<!-- No Data State -->
<div class="mb-8 bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 border border-gray-200 dark:border-gray-700">
    <div class="px-6 py-12 text-center">
        <div class="mx-auto w-24 h-24 bg-gray-100 dark:bg-gray-900 rounded-full flex items-center justify-center mb-6">
            <i class="fas fa-balance-scale text-gray-400 dark:text-gray-500 text-3xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">No Risk-Reward Data Available</h3>
        <p class="text-gray-600 dark:text-gray-300 mb-6 max-w-md mx-auto">
            To see risk-reward analysis, you need trades with stop-loss and take-profit levels set in your MT5 account.
        </p>
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
            <a href="/trades" class="inline-flex items-center justify-center px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors">
                <i class="fas fa-exchange-alt mr-2"></i>
                View Trades
            </a>
            <a href="/checklist" class="inline-flex items-center justify-center px-4 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded hover:bg-purple-700 dark:hover:bg-purple-600 transition-colors">
                <i class="fas fa-tasks mr-2"></i>
                Risk Management Checklist
            </a>
        </div>
    </div>
</div>
{% endif %}

<!-- Calculator and Guidelines Grid -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- R:R Calculator -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 overflow-hidden border border-gray-200 dark:border-gray-700">
        <div class="px-6 py-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
            <h2 class="text-lg font-bold text-gray-900 dark:text-white">Risk-Reward Calculator</h2>
            <p class="text-sm text-gray-600 dark:text-gray-300">Calculate optimal position sizing and risk</p>
        </div>
        <div class="p-6">
            <form id="rrCalculator">
                <div class="space-y-4">
                    <div>
                        <label for="entryPrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Entry Price</label>
                        <input type="number" id="entryPrice" step="0.00001" required 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="stopLoss" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Stop Loss</label>
                            <input type="number" id="stopLoss" step="0.00001" required 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        <div>
                            <label for="takeProfit" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Take Profit</label>
                            <input type="number" id="takeProfit" step="0.00001" required 
                                   class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                    </div>
                    
                    <div>
                        <label for="positionSize" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Position Size (units)</label>
                        <input type="number" id="positionSize" value="1000" required 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label for="accountSize" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Account Size ($)</label>
                        <input type="number" id="accountSize" value="10000" required 
                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <button type="button" id="calculateBtn" 
                            class="w-full bg-blue-600 dark:bg-blue-500 text-white py-2.5 px-4 rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors font-medium">
                        Calculate Risk-Reward
                    </button>
                </div>
            </form>
            
            <div id="calculationResult" class="mt-6 hidden">
                <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-5">
                    <h4 class="font-bold text-gray-900 dark:text-white mb-4">Calculation Results</h4>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Risk per Trade</div>
                            <div id="riskAmount" class="text-lg font-bold text-gray-900 dark:text-white">$0.00</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Reward per Trade</div>
                            <div id="rewardAmount" class="text-lg font-bold text-gray-900 dark:text-white">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-4">
                        <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Risk-Reward Ratio</div>
                        <div id="rrRatio" class="text-3xl font-bold text-gray-900 dark:text-white">0.00</div>
                        <div id="rrAssessment" class="text-sm mt-1"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Risk % of Account</div>
                            <div id="riskPercent" class="text-lg font-bold text-gray-900 dark:text-white">0.00%</div>
                        </div>
                        <div>
                            <div class="text-sm text-gray-600 dark:text-gray-300 mb-1">Win % Needed</div>
                            <div id="winPercentNeeded" class="text-lg font-bold text-gray-900 dark:text-white">0.00%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- R:R Guidelines -->
    <div class="space-y-6">
        <!-- Guidelines Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 overflow-hidden border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                <h2 class="text-lg font-bold text-gray-900 dark:text-white">Risk-Reward Guidelines</h2>
                <p class="text-sm text-gray-600 dark:text-gray-300">Optimal ratios for successful trading</p>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg">
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white">Excellent</div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">Win rate needed: 25%+</div>
                        </div>
                        <span class="px-3 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-medium rounded-full">
                            1:3+
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg">
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white">Good</div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">Win rate needed: 33%+</div>
                        </div>
                        <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-medium rounded-full">
                            1:2
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white">Minimum</div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">Win rate needed: 40%+</div>
                        </div>
                        <span class="px-3 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-sm font-medium rounded-full">
                            1:1.5
                        </span>
                    </div>
                    
                    <div class="flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white">Avoid</div>
                            <div class="text-sm text-gray-600 dark:text-gray-300">Win rate needed: 50%+</div>
                        </div>
                        <span class="px-3 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 text-sm font-medium rounded-full">
                            Below 1:1
                        </span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quick Tips Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow dark:shadow-gray-700/30 overflow-hidden border border-gray-200 dark:border-gray-700">
            <div class="px-6 py-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                <h2 class="text-lg font-bold text-gray-900 dark:text-white">Quick Tips</h2>
                <p class="text-sm text-gray-600 dark:text-gray-300">Essential risk management principles</p>
            </div>
            <div class="p-6">
                <ul class="space-y-3">
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-400 mt-0.5 mr-3"></i>
                        <span class="text-gray-700 dark:text-gray-300">Always set stop-loss before entering a trade</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-400 mt-0.5 mr-3"></i>
                        <span class="text-gray-700 dark:text-gray-300">Aim for minimum 1:1.5 risk-reward ratio</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-400 mt-0.5 mr-3"></i>
                        <span class="text-gray-700 dark:text-gray-300">Risk only 1-2% of account per trade</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-400 mt-0.5 mr-3"></i>
                        <span class="text-gray-700 dark:text-gray-300">Adjust position size based on stop-loss distance</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 dark:text-green-400 mt-0.5 mr-3"></i>
                        <span class="text-gray-700 dark:text-gray-300">Track your actual vs planned R:R</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // R:R Calculator
    const calculateBtn = document.getElementById('calculateBtn');
    const resultDiv = document.getElementById('calculationResult');
    
    // Auto-fill example values
    document.getElementById('entryPrice').value = '1.10000';
    document.getElementById('stopLoss').value = '1.09500';
    document.getElementById('takeProfit').value = '1.11000';
    
    calculateBtn.addEventListener('click', function() {
        const entryPrice = parseFloat(document.getElementById('entryPrice').value);
        const stopLoss = parseFloat(document.getElementById('stopLoss').value);
        const takeProfit = parseFloat(document.getElementById('takeProfit').value);
        const positionSize = parseFloat(document.getElementById('positionSize').value);
        const accountSize = parseFloat(document.getElementById('accountSize').value);
        
        if (!entryPrice || !stopLoss || !takeProfit || !positionSize || !accountSize) {
            alert('Please fill in all fields');
            return;
        }
        
        // Calculate risk and reward
        const riskPerUnit = Math.abs(entryPrice - stopLoss);
        const rewardPerUnit = Math.abs(takeProfit - entryPrice);
        
        const riskAmount = riskPerUnit * positionSize;
        const rewardAmount = rewardPerUnit * positionSize;
        
        // Calculate R:R ratio
        let rrRatio = 0;
        if (riskAmount > 0) {
            rrRatio = rewardAmount / riskAmount;
        }
        
        // Calculate percentages
        const riskPercent = (riskAmount / accountSize) * 100;
        const winPercentNeeded = (1 / (1 + rrRatio)) * 100;
        
        // Update display
        document.getElementById('riskAmount').textContent = '$' + riskAmount.toFixed(2);
        document.getElementById('rewardAmount').textContent = '$' + rewardAmount.toFixed(2);
        document.getElementById('rrRatio').textContent = rrRatio.toFixed(2);
        document.getElementById('riskPercent').textContent = riskPercent.toFixed(2) + '%';
        document.getElementById('winPercentNeeded').textContent = winPercentNeeded.toFixed(1) + '%';
        
        // Assessment
        const rrAssessment = document.getElementById('rrAssessment');
        const rrRatioElement = document.getElementById('rrRatio');
        
        if (rrRatio >= 3) {
            rrRatioElement.className = 'text-3xl font-bold text-green-600 dark:text-green-400';
            rrAssessment.textContent = 'Excellent - Keep it up!';
            rrAssessment.className = 'text-sm mt-1 text-green-600 dark:text-green-400';
        } else if (rrRatio >= 2) {
            rrRatioElement.className = 'text-3xl font-bold text-blue-600 dark:text-blue-400';
            rrAssessment.textContent = 'Good - Solid risk management';
            rrAssessment.className = 'text-sm mt-1 text-blue-600 dark:text-blue-400';
        } else if (rrRatio >= 1.5) {
            rrRatioElement.className = 'text-3xl font-bold text-yellow-600 dark:text-yellow-400';
            rrAssessment.textContent = 'Acceptable - Could be better';
            rrAssessment.className = 'text-sm mt-1 text-yellow-600 dark:text-yellow-400';
        } else {
            rrRatioElement.className = 'text-3xl font-bold text-red-600 dark:text-red-400';
            rrAssessment.textContent = 'Poor - Increase your take-profit or tighten stop-loss';
            rrAssessment.className = 'text-sm mt-1 text-red-600 dark:text-red-400';
        }
        
        // Show results
        resultDiv.classList.remove('hidden');
    });
});
</script>
{% endblock %}